{
  "hash": "612758051dbe9026fed029c08feec9da",
  "result": {
    "markdown": "---\ntitle: \"Multiple Linear Regression\"\nsubtitle: \"Summarizing linear relationships in high dimensions\"\ndate: 02/18/23\nimage: images/3d-scatterplot.png\n---\n<!-- The bit before that is commented out adds publish date to document metadata and button links at the top of the doc. This workflow can be revisited but currently doesn't work because listings aren't updated with these dates, only the renderd docs. -->\n\n::: {.cell}\n\n:::\n\n\n\n[[Discuss]{.btn .btn-primary}](https://edstem.org/us/courses/31657) [[Reading Questions]{.btn .btn-primary}](https://www.gradescope.com/courses/477232) [[PDF]{.btn .btn-primary}](notes.pdf)\n\n\n\n\\\n\n[I]{.dropcap}n the last lecture we built our first linear model: an equation of a line drawn through the scatter plot.\n\n$$ \\hat{y} = 96.2 + -0.89 x $$\n\nWhile the idea is simple enough, there is a sea of terminology that floats around this method. A *linear model* is any model that explains the $y$, often called the *response variable* or *dependent variable*, as a linear function of the $x$, often called the *explanatory variable* or *independent variable*. There are many different methods that can be used to decide which line to draw through a scatter plot. The most commonly-used approach is called the *method of least squares*, a method we'll look at closely when we turn to prediction. If we zoom out, a linear model fit by least squares is an example of a *regression model*, which refers to any model (linear or non-linear) used to explain a numerical response variable.\n\nThe reason for all of this jargon isn't purely to infuriate students of statistics. Linear models are one of the most widely used statistical tools; you can find them in used in diverse fields like biology, business, and political science. Each field tends to adapt the tool and the language around them to their specific needs.\n\nA reality of practicing statistics in these field, however, is that most data sets are more complex than the example that we saw in the last notes, where there were only two variables. Most phenomena have many different variables that relate to one another in complex ways. We need a more more powerful tool to help guide us into these higher dimensions.\n\n## Scatterplots of three variables\n\nIn studying the Grammar of Graphics, we learned how Hans Rosling's Gapminder visualization used location along the x, location along the y, color, size, and time to encode not just two but *five* different data dimensions in his scatter plot. We start with a more modest goal. Let's build a scatter plot - and a corresponding linear model - that summarizes data in three variables, and let's turn to a data set not from public health but the world of food.\n\n:::{.column-margin}\n![Hans Rosling's Gapminder visualization](images/gapminder.png)\n:::\n\nThe Zagat Guide was for many years the authoritative source of restaurant reviews. Their approach was very different from Yelp!. Zagat's review of a restaurant was compiled by a professional restaurant reviewer who would visit a restaurant and rate it on a 30 point scale across three categories: food, decor, and service. They would also note the average price of a meal and write up a narrative review.\n\nHere's an example of a review from an Italian restaurant called Marea in New York City.\n\n![](images/zagat.png){fig-alt=\"A picture of a Zagat review of the Italian restaurant Marea in New York City, with scores on food, decor, and service along with quotations from the narrative review.\" width=\"400\" fig-align=\"center\"}\n\nIn addition to learning about the food scores (27), and getting some helpful tips (\"bring your bank manager\"), we see they've also recorded a few more variables on this restaurant: the phone number and website, their opening hours, and the neighborhood (Midtown).\n\n### Two numerical, one categorical\n\nWhat is the relationship between the food quality and the price of a meal at Italian restaurant? Are these two variables positively correlated or is the best Italian meal in New York a simple and inexpensive slice of pizza?\n\nTo answer these questions, we need more data. The data frame below contains Zagat reviews from 168 Italian restaurants in Manhattan.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nzagat <- read_csv(\"https://www.dropbox.com/s/c797oanmvdzjegt/zagat.csv?dl=1\")\nzagat\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 168 × 6\n   restaurant          price  food decor service geo  \n   <chr>               <dbl> <dbl> <dbl>   <dbl> <chr>\n 1 Daniella Ristorante    43    22    18      20 west \n 2 Tello's Ristorante     32    20    19      19 west \n 3 Biricchino             34    21    13      18 west \n 4 Bottino                41    20    20      17 west \n 5 Da Umberto             54    24    19      21 west \n 6 Le Madri               52    22    22      21 west \n 7 Le Zie                 34    22    16      21 west \n 8 Pasticcio              34    20    18      21 east \n 9 Belluno                39    22    19      22 east \n10 Cinque Terre           44    21    17      19 east \n# … with 158 more rows\n```\n:::\n:::\n\n\nApplying the taxonomy of data, we see that for each restaurant we have recorded the price of an average meal, the food, decor, and service scores (all numerical variables) as well as a note regarding geography (a categorical nominal variable). `geo` captures whether the restaurant is located on the east side or the west side of Manhattan[^geo].\n\n[^geo]: Fifth Avenue is the wide north-south street that divides Manhattan into an east side and a west side.\n\nLet's summarize the relationship between food quality, price, and one categorical variable - geography - using a colored scatter plot.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nzagat %>%\n  ggplot(aes(x = food,\n             y = price,\n             color = geo)) +\n  geom_jitter() +\n  theme_bw() +\n  labs(x = \"Food Quality\",\n       y = \"Price of Average Meal\",\n       color = \"Geography\")\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=480}\n:::\n:::\n\n\nIt looks like if you want a very tasty meal, you'll have to pay for it. There is a moderately strong, positive, and linear relationship between food quality and price. This plot, however, has a third variable in it: geography. The restaurants from the east and west sides are fairly well mixed, but to my eye the points on the west side might be a tad bit lower on price than the points from the east side. I could numerically summarize the relationship between these three variables by hand-drawing two lines, one for each neighborhood.\n\n![](images/zagat-handdrawn.png){fig-align=\"center\" width=\"450\"}\n\nFor a more systematic approach for drawing lines through the center of scatter plots, we need to return to the method of least squares, which is done in R using `lm()`. In this linear model, we wish to explain the $y$ variable as a function of two explanatory variables, `food` and `geo`, both found in the `zagat` data frame. We can express that relationship using the formula notation.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nm1 <- lm(price ~ food + geo, zagat)\nm1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = price ~ food + geo, data = zagat)\n\nCoefficients:\n(Intercept)         food      geowest  \n    -15.970        2.875       -1.459  \n```\n:::\n:::\n\n\nIt worked . . . or did it? If extend our reasoning from the last notes, we should write this model as\n\n$$\\widehat{price} = -15.97 + 2.87 \\times food - 1.45 \\times geowest$$\n\nWhat does it mean to put a categorical variable, `geo`, into a linear model? And how do three three numbers translate into the two lines shown above?\n\n#### Dummy variables\n\nWhen working with linear models like the one above, the value of the explanatory variable, $geowest$, is multiplied by a slope, 1.45. According to the Taxonomy of Data, arithmetic functions like multiplication are only defined for numerical variables. While that would seem to rule out categorical variables for use as explanatory variables, statisticians have come up with a clever work-around: the dummy variable.\n\n**Dummy Variable**\n: A logical variable that is true if an observation takes a particular level of a categorical variable and false otherwise. A categorical variable with $k$ levels can be encoded using $k-1$ dummy variables.\n\nThe categorical variable `geo` can be converted into dummy variable by shifting the question from \"Which side of Manhattan are you on?\" to \"Are you on the west side of Manhattan?\" This is a `mutate` step.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nzagat %>%\n  mutate(geowest = geo == \"west\") %>%\n  select(food, price, geo, geowest)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 168 × 4\n    food price geo   geowest\n   <dbl> <dbl> <chr> <lgl>  \n 1    22    43 west  TRUE   \n 2    20    32 west  TRUE   \n 3    21    34 west  TRUE   \n 4    20    41 west  TRUE   \n 5    24    54 west  TRUE   \n 6    22    52 west  TRUE   \n 7    22    34 west  TRUE   \n 8    20    34 east  FALSE  \n 9    22    39 east  FALSE  \n10    21    44 east  FALSE  \n# … with 158 more rows\n```\n:::\n:::\n\n\nThe new dummy variable `geowest` is a *logical* variable, so it has a dual representation as TRUE/FALSE as well as 1/0. Previously, this allowed us to do Boolean algebra. Here, it allows us to include a dummy variable in a linear model.\n\nWhile you can create dummy variables by hand using `mutate`, they are created automatically whenever you put a categorical variable into `lm()`. Let's revisit the linear model that we fit above.\n\n$$\\widehat{price} = -15.97 + 2.87 \\times food - 1.45 \\times geowest$$\n\nTo understand the geometry of this model, let's focus on what the fitted values will be for any restaurant that is on the west side. For those restaurants, the `geowest` dummy variable will take a value of 1, so if we plug that in and rearrange,\n\n\\begin{eqnarray}\n\\widehat{price} &= -15.97 + 2.87 \\times food - 1.45 \\times 1 \\\\\n &= (-15.97 - 1.45) + 2.87 \\times food \\\\\n &= -17.42 + 2.87 \\times food\n\\end{eqnarray}\n\nThat is a familiar sight: that is an equation for a line.\n\nLet's repeat this process for the restaurants on the east side, where the `geowest` dummy variable will take a value of 0.\n\n\\begin{eqnarray}\n\\widehat{price} &= -15.97 + 2.87 \\times food - 1.45 \\times 0 \\\\\n &= -15.97 + 2.87 \\times food\n\\end{eqnarray}\n\nThat is also the equation for line.\n\nIf you look back and forth between these two equations, you'll notice that they share the same slope and have different y-intercepts. Geometrically, this means that the output of `lm()` was describing the equation of *two parallel lines*. That means we can use the output of `lm()` to replace my hand-drawn lines with ones that arise from the method of least squares.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nzagat <- zagat %>%\n  mutate(y_hat = fitted(m1))\n\n# We use geom_line instead of geom_abline since the model\n# now has two slope coefficients\np_parallel <- zagat %>%\n  ggplot(aes(x = food,\n             y = price,\n             color = geo)) +\n  geom_jitter() +\n  theme_bw() +\n  labs(x = \"Food Quality\",\n       y = \"Price of Average Meal\",\n       color = \"Geography\") +\n  geom_line(aes(y = y_hat))\n\np_parallel\n```\n\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=480}\n:::\n:::\n\n\n\n### Multiple Linear Regression\n\nThe model that we fit that explains the price of a meal in terms the food rating and the geography is our first example of a *multiple linear regression model*.\n\n**Multiple Linear Regression**\n:    A method of explaining a continuous numerical $y$ variable in terms of a linear function of $p$ explanatory variables, $x_i$, which can be numerical or dummy variables.\n     $$ \\hat{y} = b_0 + b_1 x_1 + b_2 x_2 + \\ldots b_p x_p $$\n     Each of the $b_i$ are called *coefficients*.\n     \nTo fit a muliple linear regression model using least squares in R, you can use the `lm()` function, which each additional explanatory variable separated by a `+`.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlm(y ~ x_1 + x_2 + x_3 ... x_p, data)\n```\n:::\n\n\nMultiple linear regression is powerful because it has no limit to the number of variables that we can include in the model. While Hans Rosling was able to fit 5 variables into a single graphic, what if we had 10 variables? Multiple linear regression allows us to understand high dimensional linear relationships beyond whats possible using our visual system.\n\nTo build intuition around how to interpret these higher dimensional models, let's look at a model that we can visualize: one with two numerical explanatory variables.\n\n### Three numerical\n\nWhile the standard scatter plot allows us to understand the association between two numerical variables like `price` and `food`, to understand the relationship between three numerical variables, we will need to build this scatterplot in 3D[^plotly].\n\n[^plotly]: While `ggplot2` is the best package for static statistical graphics, it does not have any interactive functionality. This plot was made using a system called `plotly`, which can be used both in R and Python. Read more about how it works at <https://plotly.com/r/>.\n\n\n::: {.cell}\n\n:::\n\n\n<!-- ```{=html} -->\n<!-- <center> -->\n<!-- <iframe width=\"500\" height=\"500\" -->\n<!--   src=\"images/plotly-3d.html\" -->\n<!-- ></iframe> -->\n<!-- </center> -->\n<!-- ``` -->\n\n![](images/3d-points.png){width=\"450\" fig-align=\"center\"}\n\nTake a moment to explore this scatter plot[^error]. Can you find the name of the restaurant with very bad decor but pretty good food and a price to match? (It's Gennaro.) What about the restaurant that equally bad decor but has rock bottom prices that's surprising given it's food quality isn't actually somewhat respectable? (It's Lamarca.)\n\n[^error]: This is a screenshot from an interactive 3D scatter plot. We'll see the interactive plot in class tomorrow.\n\nInstead of depicting the relationship between these three variables graphically, let's do it numerically by fitting a linear model.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nm2 <- lm(price ~ food + decor, data = zagat)\nm2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = price ~ food + decor, data = zagat)\n\nCoefficients:\n(Intercept)         food        decor  \n    -24.500        1.646        1.882  \n```\n:::\n:::\n\n\nWe can write the corresponding equation of the model as\n\n$$ \\widehat{price} = -24.5 + 1.64 \\times food + 1.88 \\times decor $$\n\nTo understand the geometry of this model, we can't use the trick that we did with dummy variables. `decor` is a numerical variable just like `food`, so it takes more values than just 0 and 1.\n\nIndeed this linear model is describing a *plane*.\n\n\n::: {.cell}\n\n:::\n\n\n<!-- ```{=html} -->\n<!-- <center> -->\n<!-- <iframe width=\"500\" height=\"500\" -->\n<!--   src=\"images/plotly-3d-plane.html\" -->\n<!-- ></iframe> -->\n<!-- </center> -->\n<!-- ``` -->\n\n![](images/3d-plane.png){width=\"450\" fig-align=\"center\"}\n\nIf you inspect this plane carefully you're realize that the tilt of the plane is not quite the same in every dimension. The tilt in the decor dimension is just a little bit steeper than that in the food dimension, a geometric expression of the fact that the coefficient in front of decor, 1.88, is just a bit higher than the coefficient in front of food, 1.64.\n\n\n#### Interpreting coefficients\n\nWhen moving from simple linear regression, with one explanatory variable, to the multiple linear regression, with many, the interpretation of the coefficients becomes trickier but also more insightful.\n\nMathematically, the coefficient in front of food, 1.64, tells us the difference that we would expect to see in the response variable, price, when two Italian restaurants are separated by a food rating of one *and they have the same decor rating*. Said another way, controlling for decor, a one point increase in the food rating is associated with a \\$1.64 increase in the price. Similarly for decor: controlling for the quality of the food, a one-point increase in decor is associated with a \\$1.88 increase in the price.\n\nThis conditional interpretation of the coefficients extends to the first setting we looked at, when one variable is numerical and the other is a dummy. Here is that model:\n\n$$\\widehat{price} = -15.97 + 2.87 \\times food - 1.45 \\times geowest$$\n\nFor two restaurants both on the same side of Manhattan, a one point increase in food score is associated with a \\$2.87 increase in the price of a meal. Also, for two restaurants with the exact same quality of food, the restaurant on the west side is expected to be \\$1.45 cheaper than the restaurant on the east side. This is a useful bit of insight - it gives a sense of what the premium is of being on the eastside. \n\nIt is also visible in the geometry of the model. When we're looking at restaurants with the same food quality, we're looking at a vertical slice of the scatter plot. Here the vertical line gray line is indicating restaurants where the food quality gets a score of 18. The difference in expected price of meals on the east side and west side is the vertical distance between the red line and the blue line, which is exactly 1.45.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](notes_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=480}\n:::\n:::\n\n\n<!-- ## Simpson's Paradox -->\n\n## Summary\n\nWe began this unit on Summarizing Data with graphical and numerical summaries of just a single variable: histograms and bar charts, means and standard deviations. In the last set of notes we introduced our first bivariate numerical summaries: the correlation coefficient, and the linear model. In these notes, we introduced multiple linear regression, a method that can numerically describe the linear relationships between an unlimited number of variables. The types of variables that can be included in these models is similarly vast. Numerical variables can be included directly, generalizing the geometry of a line into a plane in higher dimension. Categorical variables can be included using the trick of dummy variables, logical variables that take a value of 1 where a particular condition is true. The interpretation of all of the coefficients that result from a multiple regression is challenging but rewarding: it allows us to answer questions about the relationship between two variables after controlling for the values of other variables.\n\nIf this felt like a deep dive into a multiple linear regression, don't worry. Linear models are one of the most commonly used statistical tools, so we'll be revisiting them throughout the course: investigating their use in making generalizations, causal claims, and predictions.\n\n\n",
    "supporting": [
      "notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}